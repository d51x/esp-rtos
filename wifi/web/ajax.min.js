function ajax_request(t,e){var n;if("undefined"!=typeof XMLHttpRequest)n=new XMLHttpRequest;else for(var a=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],i=0,r=a.length;i<r;i++)try{n=new ActiveXObject(a[i]);break}catch(t){}n.onreadystatechange=function(){if(n.readyState<4)return;if(200!==n.status)return;4===n.readyState&&e(n)},n.open("GET",t,!0),n.send("")}function on(t,e,n){t.addEventListener?t.addEventListener(e,function(){n(t,e)},!1):t.attachEvent&&t.attachEvent(e,function(){n(t,e)})}for(var inputs=document.getElementsByTagName("input"),i=0;i<inputs.length;i++)"range"==inputs[i].type.toLowerCase()?["change","input"].forEach(function(t){on(inputs[i],t,function(t,e){"input"==e&&(document.getElementById(t.name).innerHTML=t.value)})}):"checkbox"==inputs[i].type.toLowerCase()&&"relay"==inputs[i].getAttribute("rel")&&["change","input"].forEach(function(t){on(inputs[i],t,function(t,e){if("change"==e){var n=1-parseInt(t.getAttribute("value"));ajax_request("/gpio?pin="+t.name.substr(5)+"&st="+n,function(){t.setAttribute("value",n),t.checked=n,document.getElementById(t.name).innerHTML=n?"ON":"OFF"})}"input"==e&&(document.getElementById(t.name).innerHTML=t.checked?"ON":"OFF")})});var a=document.getElementsByTagName("a");for(i=0;i<a.length;i++)"relay"==a[i].getAttribute("rel")&&on(a[i],"click",function(t,e){var n=1-parseInt(t.getAttribute("data-val"));ajax_request("/gpio?st="+n+"&pin="+t.getAttribute("data-id"),function(){t.setAttribute("data-val",n),t.innerHTML="<button class='relay "+(n?"on":"off")+"' >"+t.getAttribute("data-title")+"</button>"})});function effects(){var t=document.getElementById("effects"),e=t.options[t.selectedIndex].value;t.options[t.selectedIndex].text;ajax_request("/colors?type=effect&id="+e,function(){t.options[e].selected="true"})}function reboot(){ajax_request("/reboot?st=1",setTimeout(function(){window.location.replace("/")},3e3)),document.getElementById("rbt").style.display="block"}function i2cscan(){ajax_request("/i2cscan?st=1",function(t){document.getElementById("i2cres").innerHTML="<h4>Результаты сканирования:</h4><p>"+t.responseText+"</p>"})}function btnclick(t,e,n,a){var i=document.getElementById(t),r=i.getAttribute("data-uri"),o=i.getAttribute("data-val");console.log("params: id = %s, id2 = %s, v = %d, st = %d",t,e,n,a),ajax_request(r+o,function(t){if(1==a){var r=0,s=t.responseText;r="OFF"==s?0:0==s?0:"ON"==s?1:1==s?1:"ERROR"==s?o:"OK"==s?!o:0;var u=i.getAttribute("data-class"),c=r>0?" on":" off";i.setAttribute("class",u+c),i.setAttribute("data-val",1-r),console.log("resp = %s, vnew = %d, !vnew = %d",s,r,1-r)}var l=document.getElementById(e);if(1==n)l.innerHTML=i.getAttribute("data-text")+t.responseText;else if(2==n){var d=i.getAttribute("data-text");l.innerHTML=d.replace("{0}",t.responseText)}else l.innerHTML=i.getAttribute("data-text")})}function change_color(t,e){if(e.indexOf("ledc10")>=0){var n=document.getElementById("colors").getAttribute("style"),a=(n=(n=n.substr(15,n.length)).substr(0,n.length-1)).split(",");"ledc100"==e?a[0]=t:"ledc101"==e?a[1]=t:"ledc102"==e&&(a[2]=t),n="background:rgb("+(n=a.join())+")",document.getElementById("colors").setAttribute("style",n)}}function slider(t,e,n){change_color(t,e),ajax_request(n+t,function(t){var n=t.responseText;document.getElementById(e).innerHTML=n})}